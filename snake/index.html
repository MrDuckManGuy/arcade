<!DOCTYPE html>
<html>
<head>
	<title>arcade</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<link rel="manifest" href="manifest.json">
</head>
<body>
	<style>
		* {
			user-select: none;
			-webkit-user-select: none;
			color: white;
			font-family: monospace;
		}
		body {
			background-color: #222;
			margin: 0;
			width: 400px;
		}
		button {
			background-color: transparent;
		}
		pre {
			font-size: 4em;
		}
		.ui-element {
			display: flex;
			max-width: 100%;
		}
		p {
			display: auto;
		}
	</style>
	
	<canvas id="canvas" width="400" height="400"></canvas>
	<div class="ui-element" style="flex-direction: row-reverse;">
		<button id="mute">unmute</button>
	</div>
	<div class="ui-element" style="justify-content: center;">
		<pre id="score">SCORE 0</pre>
	</div>
	
	<script>
		const canvas = document.getElementById("canvas");
		const width = canvas.offsetWidth;
		const height = canvas.offsetHeight;
		const ctx = canvas.getContext("2d");
		
		let score = 0;
		const scoreRender = document.getElementById("score");

		const tileCount = 16;
		const tileSize = width / tileCount;

		let dirX = 0;
		let dirY = 0;

		let prevX, prevY, newX, newY;
		
		let gameState = "running";

		const snake = {
			segmentWidth: tileSize,
			segmentHeight: tileSize
		};

		const food = {
			width: tileSize,
			height: tileSize
		};
		
		function initSnake() {
			snake.segments = [{ x: 0, y: 0 }];
		}

		function initFood() {
			food.x = 15;
			food.y = 15;
		}

		addEventListener("touchstart", (e) => {
			e.preventDefault();
			prevX = e.touches[0].clientX;
			prevY = e.touches[0].clientY;
		}, { passive: false });

		addEventListener("touchend", (e) => {
			newX = e.changedTouches[0].clientX;
			newY = e.changedTouches[0].clientY;
			if (Math.abs(newX - prevX) > Math.abs(newY - prevY)) {
				if (newX > prevX) dirX = 1;
				else if (newX < prevX) dirX = -1;
				dirY = 0;
			} else if (Math.abs(newX - prevX) < Math.abs(newY - prevY)) {
				if (newY > prevY) dirY = 1;
				else if (newY < prevY) dirY = -1;
				dirX = 0;
			}
		}, { passive: false });
		
		function resetGame() {
			gameState = "ready";
			initPaddle();
			initBall();
			score = 0;
			scoreRender.textContent = "SCORE 0";
		}
		
		function addScore() {
			score++;
			scoreRender.textContent = `SCORE ${score}`;
		}
		
		function update() {
			snake.segments[0].x = Math.min(Math.max(0, snake.segments[0].x + dirX), tileCount - 1);
			snake.segments[0].y = Math.min(Math.max(0, snake.segments[0].y + dirY), tileCount - 1);
		}
		
		function draw() {
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, width, height);

			ctx.fillStyle = "green";
			for (let segment of snake.segments) {
				ctx.fillRect(segment.x * tileSize, segment.y * tileSize, snake.segmentWidth, snake.segmentHeight);
			}
			
			ctx.fillStyle = "red";
			ctx.fillRect(food.x * tileSize, food.y * tileSize, food.width, food.height);
		}
		
		// init
		initSnake();
		initFood();
		
		// game loop
		setInterval(() => {
			draw();
			if (gameState == "running") {
				update();
			}
		}, 1000 / 15);
	</script>
</body>
</html>